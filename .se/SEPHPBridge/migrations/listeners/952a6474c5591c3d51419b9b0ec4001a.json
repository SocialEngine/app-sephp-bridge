{
    "code": "const app = require('app');\n\nmodule.exports = async function (event) {\n    const check = event.payload.fileName.match(/\\/@SE\\/SEPHPBridge\\/user\\/([a-z.]+)\\/(\\d+)\\.png/);\n    if (check && check[2] !== undefined) {\n        await event.payload.render(async () => {\n            const type = check[1];\n            const user = await app.module.getUserFromLegacyId(check[2]);\n            let url = await app.data.get('sephp:url');\n            let cdnUrl = await app.setting('sephp:cdnUrl');\n            if (cdnUrl) {\n                url = cdnUrl;\n                if (url.slice(-1) === '/') {\n                    url = url.substr(0, url.length - 1);\n                }\n            }\n            let image = '';\n            let fetchImage = 'https://upload.wikimedia.org/wikipedia/commons/c/ca/1x1.png';\n            if (user.images.small !== undefined && user.images.small) {\n                let size = 'small';\n                if (type === 'thumb.profile') {\n                    size = 'large';\n                }\n                fetchImage = user.images[size];\n            } else {\n                if (user.picture && user.picture.substr(0, 1) === '[') {\n                    try {\n                        const photo = JSON.parse(user.picture);\n                        const find = photo.find(p => p.type === type);\n                        if (find) {\n                            fetchImage = url + '/' + find.path;\n                        }\n                    } catch (e) {\n                        return image;\n                    }\n                }\n            }\n            if (fetchImage) {\n                const request = await app.fetch(fetchImage);\n                image = await request.buffer();\n            }\n            return image;\n        });\n    }\n};\n",
    "events": [
        "Cdn.process"
    ],
    "version": "1.0.6"
}
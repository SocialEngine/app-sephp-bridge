{
    "code": "const app = require('app');\n\nmodule.exports = async function (event) {\n    const check = event.payload.fileName.match(/\\/@SE\\/SEPHPBridge\\/user\\/([a-z.]+)\\/(\\d+)\\.png/);\n    if (check && check[2] !== undefined) {\n        await event.payload.render(async () => {\n            /*\n            const user = await app.module.getUserFromLegacyId(check[1]);\n            const url = await app.data.get('sephp:url');\n            console.log('user', user);\n            let image = url + user.picture.replace('sephp:', '/');\n            const request = await app.fetch(image);\n            return request.buffer();\n\n             */\n            const type = check[1];\n            const user = await app.module.getUserFromLegacyId(check[2]);\n            const url = await app.data.get('sephp:url');\n            let image = '';\n            if (user.picture.substr(0, 1) === '[') {\n                try {\n                    const photo = JSON.parse(user.picture);\n                    const find = photo.find(p => p.type === type);\n                    if (find) {\n                        const request = await app.fetch(url + '/' + find.path);\n                        image = await request.buffer();\n                    }\n                } catch (e) {\n                    return image;\n                }\n            }\n            return image;\n        });\n    }\n};\n",
    "events": [
        "Cdn.process"
    ],
    "version": "1.0.6"
}